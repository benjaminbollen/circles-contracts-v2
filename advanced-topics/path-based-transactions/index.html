<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Path-based Transactions - Circles Protocol</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Path-based Transactions";
        var mkdocs_page_input_path = "advanced-topics/path-based-transactions.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Circles Protocol
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../introduction/">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architectural Overview</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Core Functionality</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../core-functionality/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../core-functionality/hub-contract/">Hub Contract</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../core-functionality/circles-contract/">Circles Contract</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../key-features/">Key Features</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../contract-interactions/">Contract Interactions</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced Topics</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../inflation-demurrage/">Inflation and Demurrage</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Path-based Transactions</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#concept-overview">Concept Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#flow-matrices">Flow Matrices</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#structure-of-a-flow-matrix">Structure of a Flow Matrix</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#an-example-of-a-flow-matrix">An example of a flow matrix</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#flow-edges-explanation">Flow edges Explanation</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#stream-explanation">Stream Explanation</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#net-flow-and-consistency-check">Net Flow and Consistency Check</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#technical-implementation">Technical Implementation</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#function-signature">Function Signature</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-steps-in-processing">Key Steps in Processing</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#key-functions">Key Functions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_verifyflowmatrix">_verifyFlowMatrix</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_effectpathtransfers">_effectPathTransfers</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_callacceptancechecks">_callAcceptanceChecks</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#trust-and-permissions">Trust and Permissions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#challenges-and-considerations">Challenges and Considerations</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../group-mint-policies/">Group Mint Policies</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guides/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guides/registration/">Registration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guides/trust-management/">Trust Management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guides/minting-transferring/">Minting and Transferring</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guides/group-currencies/">Group Currencies</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Resources</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-resources/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-resources/contract-abis/">Contract ABIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-resources/integration-guidelines/">Integration Guidelines</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer-resources/best-practices/">Best Practices</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendices</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendices/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendices/contract-addresses/">Contract Addresses</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../appendices/external-resources/">External Resources</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Circles Protocol</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Advanced Topics</li>
      <li class="breadcrumb-item active">Path-based Transactions</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="path-based-transactions-and-flow-matrices">Path-based Transactions and Flow Matrices</h1>
<p>In the Circles ecosystem, path-based transactions enable the transfer of Circles tokens between people who don't directly trust each other. This system uses flow matrices to represent and validate these multi-hop transactions.</p>
<h2 id="concept-overview">Concept Overview</h2>
<p>Path-based transactions allow Circles to be transferred along a path of trust relationships. Instead of requiring direct trust between the sender and receiver, the system finds a path through the trust network where each step involves a trusted relationship.</p>
<h2 id="flow-matrices">Flow Matrices</h2>
<p>Flow matrices are structured representations for these path-based transactions. They describe the movement of Circles tokens through the network for a given transaction (or a batch of transactions).</p>
<h3 id="structure-of-a-flow-matrix">Structure of a Flow Matrix</h3>
<p>A flow matrix consists of the following components:</p>
<ol>
<li><strong>Flow Vertices</strong>: An ordered list of avatar addresses that the transaction path touches. This includes any avatar that sends, receives or whose Circles are used in any of the flow edges. These can be humans, organizations or groups, but must be registered.</li>
<li><strong>Flow Edges</strong>: A path consists of a set of flow edges. This is expressed as an array of <code>FlowEdges</code>, each representing a transfer of a specific (personal or group) Circles type and amount between two vertices. These flow edges are applied in the order given and the order of the coordinates must match that of the flow edges. A <code>FlowEdge</code> therefore is a structure that specifies:<ul>
<li><code>amount</code>: The amount of tokens being transferred (uint192) in this edge.</li>
<li><code>streamSinkId</code>: To perform the <code>ERC1155:onERC1155Received()</code> call, the path needs to identify which edges are terminal flow edges. Therefore this references for all terminal edges a stream identifier (and is 0 for non-terminal edges; &gt;0 for terminal edges).</li>
</ul>
</li>
<li><strong>Coordinates</strong>: Packed data representing triplets of indices within the flow vertices array: for each flow edge the coordinates must provide a triplet <code>(uint16, uint16, uint16)</code>, referencing the addresses of <code>(Circles-to-send, sender, receiver)</code> read from the flow vertices array. The coordinates are input as <code>bytes</code> packed explicitly per 16 bits to avoid zero-padding for 256bit word length.</li>
<li><strong>Streams</strong>: A stream represents the actual intent of a sender to send an amount of Circles to a receiver - without specifying which Circles to send or over which path, simply that the receiver only ever receives Circles they trust. A stream specifies a <code>sourceCoordinate</code> as the index of the source (or sender) in the flow vertices array, an array of the <code>flowEdgeIds</code> to cross-reference with the flow edges the correct terminal edges of this stream; and <code>bytes data</code> that will be sent to the receiver of the stream in the acceptance call. A flow matrix can have:<ul>
<li>zero streams provided: All edges combined must form a closed path where no sender and no receiver nett-receives or nett-sends an amount of Circles. This can be used to reorganise the balances of Circles across the graph.</li>
<li>one stream provided: The flow matrix represents the path of a single intended transfer between a sender and receiver.</li>
<li>two or more streams: The flow matrix represents a batch of intents of multiple senders to send Circles to receivers, and they get settled on-chain as single path (while still performing the acceptance checks for each stream's receiver).</li>
</ul>
</li>
</ol>
<h3 id="an-example-of-a-flow-matrix">An example of a flow matrix</h3>
<p>Let's illustrate a flow matrix and streams with an example. Let's assume we have the following avatars (only humans).</p>
<pre><code>Avatars (Flow Vertices):
A: Alice
B: Bob
C: Charlie
D: David
E: Eva
</code></pre>
<p>Let's assume Alice wants to send 3 CRC to David, and 5 CRC to Eva. Bob wants to send 4 CRC to David as well. Let's assume they have the following trust graph among them (where the arrow means "trusts"):</p>
<p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MDAgMzAwIj4KICA8c3R5bGU+CiAgICAubm9kZSB7IGZpbGw6ICNmZjk3ODY7IHN0cm9rZTogIzM4MzE4Yjsgc3Ryb2tlLXdpZHRoOiAyOyB9CiAgICAubGFiZWwgeyBmaWxsOiAjMzgzMThiOyBmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IGZvbnQtc2l6ZTogMTRweDsgfQogICAgLmFycm93IHsgZmlsbDogbm9uZTsgc3Ryb2tlOiAjMzgzMThiOyBzdHJva2Utd2lkdGg6IDI7IH0KICAgIC5hcnJvd2hlYWQgeyBmaWxsOiAjMzgzMThiOyB9CiAgPC9zdHlsZT4KICAKICA8IS0tIE5vZGVzIC0tPgogIDxjaXJjbGUgY2xhc3M9Im5vZGUiIGN4PSIxMDAiIGN5PSIxNTAiIHI9IjMwIiAvPgogIDxjaXJjbGUgY2xhc3M9Im5vZGUiIGN4PSIyMDAiIGN5PSIxNTAiIHI9IjMwIiAvPgogIDxjaXJjbGUgY2xhc3M9Im5vZGUiIGN4PSIzMDAiIGN5PSIxNTAiIHI9IjMwIiAvPgogIDxjaXJjbGUgY2xhc3M9Im5vZGUiIGN4PSI0MDAiIGN5PSIxMDAiIHI9IjMwIiAvPgogIDxjaXJjbGUgY2xhc3M9Im5vZGUiIGN4PSI0MDAiIGN5PSIyMDAiIHI9IjMwIiAvPgogIAogIDwhLS0gTGFiZWxzIC0tPgogIDx0ZXh0IGNsYXNzPSJsYWJlbCIgeD0iMTAwIiB5PSIxNTUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkE8L3RleHQ+CiAgPHRleHQgY2xhc3M9ImxhYmVsIiB4PSIyMDAiIHk9IjE1NSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+QjwvdGV4dD4KICA8dGV4dCBjbGFzcz0ibGFiZWwiIHg9IjMwMCIgeT0iMTU1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5DPC90ZXh0PgogIDx0ZXh0IGNsYXNzPSJsYWJlbCIgeD0iNDAwIiB5PSIxMDUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPkQ8L3RleHQ+CiAgPHRleHQgY2xhc3M9ImxhYmVsIiB4PSI0MDAiIHk9IjIwNSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+RTwvdGV4dD4KICAKICA8IS0tIEFycm93cyAtLT4KICA8cGF0aCBjbGFzcz0iYXJyb3ciIGQ9Ik0xNzAgMTUwIEwxMzAgMTUwIiBtYXJrZXItZW5kPSJ1cmwoI2Fycm93aGVhZCkiIC8+CiAgPHBhdGggY2xhc3M9ImFycm93IiBkPSJNMjMwIDE1MCBMMjcwIDE1MCIgbWFya2VyLWVuZD0idXJsKCNhcnJvd2hlYWQpIiAvPgogIDxwYXRoIGNsYXNzPSJhcnJvdyIgZD0iTTI3MCAxNTAgTDIzMCAxNTAiIG1hcmtlci1lbmQ9InVybCgjYXJyb3doZWFkKSIgLz4KICA8cGF0aCBjbGFzcz0iYXJyb3ciIGQ9Ik0zMzAgMTUwIEwzNzAgMTEwIiBtYXJrZXItZW5kPSJ1cmwoI2Fycm93aGVhZCkiIC8+CiAgPHBhdGggY2xhc3M9ImFycm93IiBkPSJNMzcwIDExMCBMMzMwIDE1MCIgbWFya2VyLWVuZD0idXJsKCNhcnJvd2hlYWQpIiAvPgogIDxwYXRoIGNsYXNzPSJhcnJvdyIgZD0iTTQwMCAxNzAgTDQwMCAxMzAiIG1hcmtlci1lbmQ9InVybCgjYXJyb3doZWFkKSIgLz4KICAKICA8IS0tIEFycm93aGVhZCBkZWZpbml0aW9uIC0tPgogIDxkZWZzPgogICAgPG1hcmtlciBpZD0iYXJyb3doZWFkIiBtYXJrZXJXaWR0aD0iMTAiIG1hcmtlckhlaWdodD0iNyIgcmVmWD0iOSIgcmVmWT0iMy41IiBvcmllbnQ9ImF1dG8iPgogICAgICA8cG9seWdvbiBjbGFzcz0iYXJyb3doZWFkIiBwb2ludHM9IjAgMCwgMTAgMy41LCAwIDciIC8+CiAgICA8L21hcmtlcj4KICA8L2RlZnM+Cjwvc3ZnPg==" alt="Circles Trust Graph" style="max-width: 500px; width: 100%; height: auto;"></p>
<p>We can assume that everyone already holds some balances of the tokens of the people they trust. A possible path could look like the following:</p>
<pre><code class="language-sh">+----------+-----+-----+-----+-----+-----+
|          |  A  |  B  |  C  |  D  |  E  |
+----------+-----+-----+-----+-----+-----+
| A-B      | -8A |  8A |     |     |     |
+----------+-----+-----+-----+-----+-----+
| B-D (T2) |     | -4C |     |  4C |     |
+----------+-----+-----+-----+-----+-----+
| B-C      |     | -5B |  5B |     |     |
+----------+-----+-----+-----+-----+-----+
| B-D (T1) |     | -3C |     |  3C |     |
+----------+-----+-----+-----+-----+-----+
| C-E (T3) |     |     | -5D |     |  5D |
+==========+=====+=====+=====+=====+=====+
| Net Flow | -8  | -4  |   0 |  7  |  5  |
+==========+=====+=====+=====+=====+=====+
| Stream 1 | -3  |     |     |  3  |     |
+----------+-----+-----+-----+-----+-----+
| Stream 2 |     | -4  |     |  4  |     |
+----------+-----+-----+-----+-----+-----+
| Stream 3 | -5  |     |     |     |  5  |
+----------+-----+-----+-----+-----+-----+
</code></pre>
<p>In this diagram, positive values represent incoming tokens and negative values represent outgoing tokens; the letters <code>(A, B, C, D)</code> represent the type of Circles tokens being transfered; and streams don't specify token types, only amounts.</p>
<h4 id="flow-edges-explanation">Flow edges Explanation</h4>
<p>Note: flow edge arrays and flow vertices arrays are indexed from 0. Streams are explicitly indexed from 1, because we reserve 0 for not-referencing a stream. (And Markdown will not enumerate from 0, so subtract 1 here):</p>
<ol>
<li>A-B: Alice sends 8 of her own Circles (A) to Bob.<ul>
<li><code>(amount = 8, streamSinkId = 0)</code></li>
<li>coordinates <code>(A, A, B)</code></li>
</ul>
</li>
<li>B-D: Bob sends 4 of Charlie's Circles (C) to David.<ul>
<li><code>(amount = 4, streamSinkId = 2)</code></li>
<li>coordinates <code>(C, B, D)</code></li>
</ul>
</li>
<li>B-C: Bob sends 5 of his own Circles (B) to Charlie.<ul>
<li><code>(amount = 5, streamSinkId = 0)</code></li>
<li>coordinates <code>(B, B, C)</code></li>
</ul>
</li>
<li>B-D: Bob sends 3 of Charlie's Circles (C) to David.<ul>
<li><code>(amount = 3, streamSinkId = 1)</code></li>
<li>coordinates <code>(C, D, D)</code></li>
</ul>
</li>
<li>C-E: Charlie sends 5 of David's Circles (D) to Eva.<ul>
<li><code>(amount = 5, streamSinkId = 3)</code></li>
<li>coordinates <code>(D, C, E)</code></li>
</ul>
</li>
</ol>
<h4 id="stream-explanation">Stream Explanation</h4>
<ul>
<li>Stream 1: Alice intends to send 3 Circles from her to David.<ul>
<li><code>sourceCoordinate = 0</code> (Alice)</li>
<li><code>flowEdgeIds = [3]</code> (fourth edge B-D is the single terminal edge for stream 1)</li>
<li><code>data</code> (some message Alice sends along to David)</li>
</ul>
</li>
<li>Stream 2: Bob intends to send 4 Circles to David. <ul>
<li><code>sourceCoordinate = 1</code> (Bob)</li>
<li><code>flowEdgeIds = [1]</code> (second edge B-D is single terminal edge for stream 2)</li>
<li><code>data</code></li>
</ul>
</li>
<li>Stream 3: Alice intends to send 5 Circles to Eva.<ul>
<li><code>sourceCoorindate = 0</code></li>
<li><code>flowEdgeIds = [4]</code> (fifth edge C-E terimates stream 3)</li>
<li><code>data</code></li>
</ul>
</li>
</ul>
<h2 id="net-flow-and-consistency-check">Net Flow and Consistency Check</h2>
<p>The net flow is not sent as input to the contracts, rather it is included in the diagram to illustrate the consistency check that the contract performs.
For an explicit path of flow edges to be a valid solution to the set of intents expressed in the streams, it must hold that
for every vertex the sum over all flow edges (modulo Circles Id) must equal the sum over all streams (ie. summing the columns).</p>
<p>Streams themselves don't specify an amount though - both to compactify the representation but also to not over-determine the representation. Instead it is checked that for each stream:</p>
<ul>
<li>all the terminal edges that reference this stream have the same receiver.</li>
<li>that each stream lists their terminal flow edge ids in ascending order.</li>
<li>and that the count of terminal edges that reference a stream, matches the length of the <code>flowEdgeIds</code> array of that stream.</li>
</ul>
<p>By cross-referencing, and checking consistency we ensure that we can use the sum of the terminal edges for a stream as the amount intended to send by that stream.</p>
<p>In our example, all streams only had one terminal flow edge, but in general a flow matrix can have multiple terminal flow edges for a single stream.</p>
<h2 id="technical-implementation">Technical Implementation</h2>
<p>The <code>Hub</code> contract implements path-based transactions through the <code>operateFlowMatrix</code> function. Let's break down its key components:</p>
<h3 id="function-signature">Function Signature</h3>
<pre><code class="language-solidity">function operateFlowMatrix(
    address[] calldata _flowVertices,
    FlowEdge[] calldata _flow,
    Stream[] calldata _streams,
    bytes calldata _packedCoordinates
) external nonReentrant(0)
</code></pre>
<h3 id="key-steps-in-processing">Key Steps in Processing</h3>
<ol>
<li>
<p><strong>Unpacking Coordinates</strong>: 
   The packed coordinates are unpacked into an array of <code>uint16</code> values.</p>
</li>
<li>
<p><strong>Verification</strong>:</p>
</li>
<li>The flow matrix is verified for correctness using <code>_verifyFlowMatrix</code>.</li>
<li>
<p>This checks that all vertices are valid avatars and that trust relationships are respected.</p>
</li>
<li>
<p><strong>Effecting Transfers</strong>:</p>
</li>
<li>The actual transfers are processed using <code>_effectPathTransfers</code>.</li>
<li>
<p>This function handles both regular transfers and group mints when applicable.</p>
</li>
<li>
<p><strong>Acceptance Checks</strong>:</p>
</li>
<li>
<p>The <code>_callAcceptanceChecks</code> function performs necessary checks for each stream in the transaction.</p>
</li>
<li>
<p><strong>Flow Matching</strong>:</p>
</li>
<li>The netted flows from the streams and the matrix are compared to ensure they match.</li>
</ol>
<h2 id="key-functions">Key Functions</h2>
<h3 id="_verifyflowmatrix">_verifyFlowMatrix</h3>
<p>This function performs crucial checks:
- Ensures all vertices are registered avatars.
- Verifies that receivers trust the Circles being sent.
- Calculates the netted flow for each vertex.</p>
<h3 id="_effectpathtransfers">_effectPathTransfers</h3>
<p>This function:
- Processes each flow edge, either as a transfer or a group mint.
- Keeps track of stream definitions and ensures their correctness.</p>
<h3 id="_callacceptancechecks">_callAcceptanceChecks</h3>
<p>This function:
- Calls acceptance checks for each stream.
- Emits <code>StreamCompleted</code> events for successful transfers.</p>
<h2 id="trust-and-permissions">Trust and Permissions</h2>
<p>The system uses two key functions to manage trust and permissions:</p>
<ol>
<li><code>isTrusted(address _truster, address _trustee)</code>: Checks if the truster trusts the trustee.</li>
<li><code>isPermittedFlow(address _to, address _circlesAvatar)</code>: Ensures both that the receiver trusts the Circles being sent and that the Circles avatar trusts the receiver.</li>
</ol>
<h2 id="challenges-and-considerations">Challenges and Considerations</h2>
<ol>
<li><strong>Complexity</strong>: Path-based transactions involve multiple checks and operations, making them computationally intensive.</li>
<li><strong>Gas Costs</strong>: The complexity of these transactions can lead to higher gas costs, which needs to be balanced against the benefits of the system.</li>
<li><strong>Trust Dynamics</strong>: The system relies on up-to-date trust relationships, which can change over time.</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>Path-based transactions and flow matrices form the backbone of Circles' unique approach to creating a trust-based economy. By enabling multi-hop transfers through trust networks, Circles can facilitate transactions between individuals who don't directly trust each other, expanding the utility and reach of the system.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../inflation-demurrage/" class="btn btn-neutral float-left" title="Inflation and Demurrage"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../group-mint-policies/" class="btn btn-neutral float-right" title="Group Mint Policies">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../inflation-demurrage/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../group-mint-policies/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
